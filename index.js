(function(){"use strict";function p(i,t,e,a,u,o,s,l){var n=typeof i=="function"?i.options:i;return t&&(n.render=t,n.staticRenderFns=e,n._compiled=!0),o&&(n._scopeId="data-v-"+o),{exports:i,options:n}}const h={name:"NavigationPageItem",props:{item:{type:Object,required:!0},image:{type:Object,default:()=>({back:"pattern",color:"gray-500",icon:"page"})}},computed:{normalizedImage(){return this.item.image?{src:this.item.image,cover:!0,back:"pattern",ratio:"1/1",...this.image}:{back:"pattern",color:"gray-500",icon:"page",...this.image}}},methods:{handleStatusClick(i){this.$dialog(`pages/${i.path}/changeStatus`)},getIconColor(i){return i==="listed"?"color: var(--color-green-500)":"color: var(--color-blue-500)"}}};var m=function(){var t=this,e=t._self._c;return t.item.type==="page"?e("k-item",{staticClass:"k-draggable-item",attrs:{sortable:t.item.sortable,text:t.item.text,link:"pages/"+t.item.path,image:t.normalizedImage},scopedSlots:t._u([{key:"options",fn:function(){return[e("k-button",{staticClass:"k-button k-status-icon",style:t.getIconColor(t.item.flag.status),attrs:{icon:"status-"+t.item.flag.status,"data-type":"status-"+t.item.flag.status,"data-theme":t.item.flag.status==="listed"?"positive-icon":"info-icon"},on:{click:function(a){return t.handleStatusClick(t.item)}}})]},proxy:!0}],null,!1,2481318459)}):t._e()},f=[],v=p(h,m,f,!1,null,"6c660d46");const d=v.exports,_={name:"NavigationGroup",components:{PageItem:d},props:{value:{type:Object,required:!0},fields:{type:Object,default:()=>({})},image:{type:Object,default:()=>({})}},data(){return{draggedElement:null,isDragging:!1}},methods:{onDragChange(i){const t={...this.value,pages:this.value.pages};this.$emit("input",t)},onGroupOption(i){this.$emit(i)},toggleGroup(){this.$emit("input",{...this.value,open:!this.value.open})}}};var k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-navigation-group"},[e("button",{staticClass:"k-button k-sort-handle k-sort-button k-item-sort-handle",attrs:{"data-has-icon":"true","aria-label":t.$t("field.navigationgroups.group.sort"),title:t.$t("field.navigationgroups.group.sort"),type:"button",tabindex:"-1"}},[e("span",{staticClass:"k-button-icon"},[e("svg",{staticClass:"k-icon",attrs:{"aria-hidden":"true","data-type":"sort"}},[e("use",{attrs:{"xlink:href":"#icon-sort"}})])])]),e("header",{staticClass:"k-navigation-group-header"},[e("div",{staticClass:"k-navigation-group-header-title"},[e("k-button",{attrs:{variant:"ghost",icon:t.value.open?"angle-down":"angle-right",title:t.$t(t.value.open?"field.navigationgroups.closeGroup":"field.navigationgroups.openGroup")},on:{click:t.toggleGroup}}),e("h3",[t._v(t._s(t.value.title))])],1),e("div",{staticClass:"k-navigation-group-header-options",on:{mousedown:function(a){a.stopPropagation()}}},[e("k-options-dropdown",{attrs:{options:[{text:t.$t("edit"),icon:"edit",click:"edit"},{text:t.$t("delete"),icon:"trash",click:"delete"}]},on:{action:function(a){return t.onGroupOption(a)}}})],1)]),t.value.open?e("k-draggable",{ref:"groupDraggable",staticClass:"k-draggable-group",class:{"k-empty":!t.value.pages.length},attrs:{list:t.value.pages,handle:".k-item-sort-handle",options:{group:{name:"pages",pull:!0,put:(a,u,o)=>{const s=o.__vue__&&o.__vue__.$children[0]&&o.__vue__.$children[0].$options.name==="NavigationPageItem",l=o.__vue__&&o.__vue__.$children[0]&&o.__vue__.$children[0].$options.name==="NavigationGroup";return s&&!l}},animation:150}},on:{change:t.onDragChange}},t._l(t.value.pages,function(a){return e("k-box",{key:a.id},[e("PageItem",{attrs:{item:a,image:t.image}})],1)}),1):t._e(),e("footer",{staticClass:"k-navigation-group-footer"})],1)},$=[],b=p(_,k,$,!1,null,"497a8b13");const y=b.exports,C={name:"NavigationRoot",components:{PageItem:d,GroupItem:y},props:{value:{type:Array,default:()=>[]},path:{type:String,required:!0},label:{type:String,required:!0},image:{type:Object,default:()=>({})},fields:{type:Object,default:()=>{}},status:{type:String,default:"listed"}},data(){return{pages:this.value||[],draggedElement:null,isDragging:!1}},created(){this.loadPages()},mounted(){this.$events.on("page.changeStatus",this.loadPages)},destroyed(){this.$events.off("page.changeStatus",this.loadPages)},computed:{groupStats(){const i=this.value.filter(a=>a.type==="group"),t=i.filter(a=>a.open).length,e=i.length;return{openCount:t,closedCount:e-t,totalCount:e,shouldClose:t>=e/2}},toggleAllIcon(){return this.groupStats.shouldClose?"angle-down":"angle-right"},toggleAllTooltip(){return this.groupStats.shouldClose?this.$t("field.navigationgroups.closeAll"):this.$t("field.navigationgroups.openAll")}},methods:{openDialog(i,t){const e=this.fields||{};this.$panel.dialog.open({component:"k-form-dialog",props:{fields:e,value:i==="add"?{}:{title:t.title,...t}},on:{submit:a=>{i==="add"?this.$emit("input",[...this.value,{uuid:this.$helper.string.uuid(),type:"group",title:a.title,open:!0,...a,pages:[]}]):this.$emit("input",this.value.map(u=>u.uuid===t.uuid?{...u,...a}:u)),this.$panel.dialog.close()}}})},addGroup(){this.openDialog("add")},onRootChange(i){this.$emit("input",this.value)},onGroupOption(i,t){i==="edit"?this.openDialog("edit",t):this.$panel.dialog.open({component:"k-remove-dialog",props:{text:this.$t("field.navigationgroups.group.delete.confirm",{name:t.text})},on:{submit:()=>{this.deleteGroup(t),this.$panel.dialog.close()}}})},deleteGroup(i){if(i.pages.length){const t=[...this.value],e=t.findIndex(a=>a.uuid===i.uuid);t.splice(e,1,...i.pages.map(a=>({type:"page",...a}))),this.$emit("input",t);return}this.$emit("input",this.value.filter(t=>t.uuid!==i.uuid?t:null))},async loadPages(){var o;const i=this.path===void 0?"site":this.path,t=await this.$api.get(`navigation-groups/pages?path=${i}&status=${this.status}`),e=[...this.value];for(let s=e.length-1;s>=0;s--){const l=e[s];if(l.type==="page"){const n=t.find(r=>r.id===l.id);n?e[s]={...l,text:n.title,path:n.path.replace(/\//g,"+"),image:n.image||null,flag:{status:n.status,icon:"icon-status-"+n.status,disabled:!((o=n.permissions)!=null&&o.changeStatus),statusId:n.id}}:e.splice(s,1)}else l.type==="group"&&l.pages.length&&(l.pages=l.pages.map(n=>{var c;const r=t.find(g=>g.id===n.id);if(r){const g=r.path.replace(/\//g,"+");return{...n,text:r.title,path:g,image:r.image||null,flag:{status:r.status,icon:"icon-status-"+r.status,disabled:!((c=r.permissions)!=null&&c.changeStatus),statusId:r.id}}}return null}).filter(Boolean))}const a=new Set(e.flatMap(s=>s.type==="page"?[s.id]:s.pages.map(l=>l.id))),u=t.filter(s=>!a.has(s.id)).map(s=>{var l;return{type:"page",id:s.id,path:s.path.replace(/\//g,"+"),text:s.title,uuid:s.uuid,sortable:!0,image:s.image||null,flag:{status:s.status,icon:"icon-status-"+s.status,disabled:!((l=s.permissions)!=null&&l.changeStatus),statusId:s.id}}});e.push(...u),this.pages=t},updateGroup(i,t){const e=[...this.value],a=e.findIndex(u=>u.uuid===t.uuid);a!==-1&&(e[a]={...e[a],...t}),this.$emit("input",e)},toggleAll(){const i=this.value.map(t=>t.type==="group"?{...t,open:!this.groupStats.shouldClose}:t);this.$emit("input",i)}}};var x=function(){var t=this,e=t._self._c;return e("section",{staticClass:"k-section"},[e("header",{staticClass:"k-section-header"},[e("h2",{staticClass:"k-label k-section-label"},[e("span",{staticClass:"k-label-text"},[t._v(t._s(t.label))])]),e("div",{staticClass:"k-button-group k-section-buttons"},[e("k-button",{attrs:{variant:"filled",size:"xs",icon:t.toggleAllIcon,title:t.toggleAllTooltip},on:{click:t.toggleAll}}),e("k-button",{attrs:{variant:"filled",size:"xs",icon:"addgroup",title:t.$t("field.navigationgroups.addGroup")},on:{click:t.addGroup}})],1)]),t.value.length?t._e():e("k-empty",{attrs:{icon:"page",text:t.$t("pages.empty")}}),e("k-draggable",{staticClass:"k-draggable-container",attrs:{list:t.value,handle:".k-item-sort-handle",options:{group:{name:"pages",pull:!0,put:!0},animation:150}},on:{change:t.onRootChange}},t._l(t.value,function(a,u){return e("k-box",{key:a.id},[a.type==="group"?e("GroupItem",{attrs:{value:a,fields:t.fields,image:t.image},on:{input:function(o){return t.updateGroup(u,o)},edit:function(o){return t.onGroupOption("edit",a)},delete:function(o){return t.onGroupOption("delete",a)}}}):e("PageItem",{attrs:{item:a,image:t.image}})],1)}),1)],1)},I=[],G=p(C,x,I,!1,null,"6263d481");const S=G.exports;panel.plugin("philippoehrlein/kirby-navigation-groups",{icons:{addgroup:'<path d="M4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM5 5V19H19V5H5ZM11 11V7H13V11H17V13H13V17H11V13H7V11H11Z"></path>'},fields:{navigationgroups:S}})})();
